<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CMNK Staking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      background: linear-gradient(180deg, #061a3a, #020d1f);
      font-family: Arial, sans-serif;
      color: #fff;
    }

    .card {
      width: 360px;
      margin: 120px auto;
      padding: 30px;
      background: #0d2b55;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,.4);
    }

    h1 {
      margin-top: 0;
    }

    .btn {
      margin-top: 20px;
      width: 100%;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #00cfff;
      color: #002033;
      font-weight: bold;
    }

    .btn:disabled {
      background: #2c4a66;
      cursor: not-allowed;
      color: #aaa;
    }

    .info {
      margin-top: 15px;
      font-size: 14px;
      color: #bcd7ff;
      word-break: break-all;
    }

    .row {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>CMNK Staking</h1>
    <div class="info">BNB Chain</div>

    <div class="row">
      <span>Your Staked</span>
      <span id="staked">-</span>
    </div>

    <div class="row">
      <span>Pending Rewards</span>
      <span id="rewards">-</span>
    </div>

    <button id="connectBtn" class="btn" onclick="connectWallet()">
      Connect Wallet
    </button>

    <div id="status" class="info">Wallet disconnected</div>
  </div>

<script>
/* ================== CONFIG ================== */

const STAKING_CONTRACT = "0x07d62b6725f59e4ca7dfc04586c0cf294f58aa9";

const STAKING_ABI = [
  "function stakes(address) view returns (uint256 amount, uint256 rewardDebt, uint256 lastUpdate)",
  "function pendingRewards(address user) view returns (uint256)"
];

/* ================== GLOBALS ================== */

let provider;
let signer;
let user;
let staking;

/* ================== CONNECT ================== */

async function connectWallet() {
  if (!window.ethereum) {
    alert("MetaMask not detected");
    return;
  }

  try {
    // üîë TYLKO TO otwiera popup MetaMask
    await window.ethereum.request({ method: "eth_requestAccounts" });

    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    user = await signer.getAddress();

    staking = new ethers.Contract(
      STAKING_CONTRACT,
      STAKING_ABI,
      provider // READ-ONLY
    );

    document.getElementById("connectBtn").innerText = "Wallet Connected";
    document.getElementById("connectBtn").disabled = true;
    document.getElementById("status").innerText =
      "Connected: " + user.slice(0, 6) + "..." + user.slice(-4);

    console.log("‚úÖ Connected:", user);

    await loadReadData();

  } catch (err) {
    console.error("‚ùå User rejected connection", err);
  }
}

/* ================== READ DATA ================== */

async function loadReadData() {
  try {
    const stakeData = await staking.stakes(user);
    const pending = await staking.pendingRewards(user);

    document.getElementById("staked").innerText =
      ethers.utils.formatEther(stakeData.amount);

    document.getElementById("rewards").innerText =
      ethers.utils.formatEther(pending);

    console.log("‚úÖ Read data OK");

  } catch (err) {
    console.error("‚ùå Read failed", err);
  }
}
</script>
</body>
</html>
