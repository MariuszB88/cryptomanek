<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CMNK Staking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Ethers v5 ‚Äì STABILNA -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    body {
      background: linear-gradient(180deg, #0a2342, #000);
      font-family: Arial, sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .card {
      background: #0e2a4d;
      padding: 30px;
      border-radius: 12px;
      width: 360px;
      text-align: center;
      box-shadow: 0 0 40px rgba(0,0,0,0.6);
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    .primary { background: #00cfff; color: #000; }
    .danger { background: #ff5c5c; color: #000; }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
      font-size: 15px;
    }
    .status {
      margin-top: 10px;
      font-size: 13px;
      color: #ccc;
      word-break: break-all;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>CMNK Staking</h2>
  <p>BNB Chain</p>

  <p>Your Staked: <span id="staked">-</span></p>
  <p>Pending Rewards: <span id="rewards">-</span></p>

  <button class="primary" id="connectBtn">Connect Wallet</button>

  <input type="text" id="amount" placeholder="Amount to stake" />

  <button class="primary" id="stakeBtn">Stake</button>
  <button class="primary" id="claimBtn">Claim Rewards</button>
  <button class="danger" id="unstakeBtn">Unstake</button>

  <div class="status" id="status">Wallet disconnected</div>
</div>

<script>
/* ================= CONFIG ================= */

const STAKING_CONTRACT_ADDRESS = "0xYOUR_STAKING_CONTRACT";

/* PRZYK≈ÅADOWE ABI ‚Äì DOSTOSUJ DO SWOJEGO KONTRAKTU */
const STAKING_ABI = [
  "function stake(uint256 amount)",
  "function unstake()",
  "function claim()",
  "function stakedBalance(address user) view returns (uint256)",
  "function pendingRewards(address user) view returns (uint256)"
];

/* ================= GLOBALS ================= */

let provider;
let signer;
let contract;
let userAddress;

/* ================= HELPERS ================= */

function setStatus(msg) {
  document.getElementById("status").innerText = msg;
}

/* ================= CONNECT ================= */

async function connectWallet() {
  if (!window.ethereum) {
    alert("MetaMask not installed");
    return;
  }

  provider = new ethers.providers.Web3Provider(window.ethereum);

  // üî¥ TO ZAWSZE WYWO≈ÅUJE POPUP (je≈õli strona nie jest zapamiƒôtana)
  await provider.send("eth_requestAccounts", []);

  signer = provider.getSigner();
  userAddress = await signer.getAddress();

  contract = new ethers.Contract(
    STAKING_CONTRACT_ADDRESS,
    STAKING_ABI,
    signer
  );

  setStatus("Connected: " + userAddress);
  await readData();
}

/* ================= READ ================= */

async function readData() {
  if (!contract || !userAddress) return;

  try {
    const staked = await contract.stakedBalance(userAddress);
    const rewards = await contract.pendingRewards(userAddress);

    document.getElementById("staked").innerText =
      ethers.utils.formatUnits(staked, 18);

    document.getElementById("rewards").innerText =
      ethers.utils.formatUnits(rewards, 18);
  } catch (e) {
    console.error(e);
  }
}

/* ================= ACTIONS ================= */

async function stake() {
  if (!contract) await connectWallet();

  const amount = document.getElementById("amount").value;
  if (!amount || isNaN(amount)) return alert("Invalid amount");

  const tx = await contract.stake(
    ethers.utils.parseUnits(amount, 18)
  );

  setStatus("Staking...");
  await tx.wait();
  setStatus("Stake successful");
  await readData();
}

async function claim() {
  if (!contract) await connectWallet();

  const tx = await contract.claim();
  setStatus("Claiming...");
  await tx.wait();
  setStatus("Rewards claimed");
  await readData();
}

async function unstake() {
  if (!contract) await connectWallet();

  const tx = await contract.unstake();
  setStatus("Unstaking...");
  await tx.wait();
  setStatus("Unstaked");
  await readData();
}

/* ================= EVENTS ================= */

document.getElementById("connectBtn").onclick = connectWallet;
document.getElementById("stakeBtn").onclick = stake;
document.getElementById("claimBtn").onclick = claim;
document.getElementById("unstakeBtn").onclick = unstake;

</script>

</body>
</html>
