<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CMNK Staking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #0a2540, #0b3d91);
  color: #ffffff;
}
.container {
  max-width: 420px;
  margin: 60px auto;
  padding: 24px;
  background: rgba(255, 255, 255, 0.06);
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}
h1 {
  text-align: center;
  margin-bottom: 6px;
}
.subtitle {
  text-align: center;
  font-size: 14px;
  color: #bcd7ff;
  margin-bottom: 24px;
}
.stat {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
  font-size: 14px;
}
input {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  margin: 12px 0;
  font-size: 16px;
}
button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}
.primary {
  background: #00ccff;
  color: #002b5c;
}
.secondary {
  background: #ffffff;
  color: #002b5c;
}
.danger {
  background: #ff5c5c;
  color: #ffffff;
}
.footer {
  text-align: center;
  font-size: 12px;
  margin-top: 20px;
  color: #bcd7ff;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>

<body>
<div class="container">
  <h1>CMNK Staking</h1>
  <div class="subtitle">5% APR • No lock time • BNB Chain</div>

  <div class="stat">
    <span>Your Staked</span>
    <strong id="stakedAmount">-</strong>
  </div>
  <div class="stat">
    <span>Pending Rewards</span>
    <strong id="pendingRewards">-</strong>
  </div>

  <button id="connectWallet" class="primary">Connect Wallet</button>

  <input id="stakeInput" type="number" placeholder="Amount to stake" disabled />
  <button id="stakeBtn" class="primary" disabled>Stake</button>
  <button id="claimBtn" class="secondary" disabled>Claim Rewards</button>
  <button id="unstakeBtn" class="danger" disabled>Unstake</button>

  <div class="footer">
    Staking contract:<br>
    0x07d62b6725f559e4ca7dfc04586c0cf294f58aa9
  </div>
</div>

<script>
/* ===== GLOBAL STATE ===== */
let web3;
let userAccount = null;
let isConnected = false;

const stakingAddress = "0x07d62b6725f559e4ca7dfc04586c0cf294f58aa9";
const tokenAddress   = "0xd17c85824eB60d40D332e64B0167E0B4029F49BA";

/* ===== ERC20 ABI ===== */
const erc20Abi = [
  {
    "constant": true,
    "inputs": [{ "name": "owner", "type": "address" }],
    "name": "balanceOf",
    "outputs": [{ "name": "", "type": "uint256" }],
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      { "name": "spender", "type": "address" },
      { "name": "amount", "type": "uint256" }
    ],
    "name": "approve",
    "outputs": [{ "name": "", "type": "bool" }],
    "type": "function"
  }
];

/* ===== STAKING ABI ===== */
const stakingAbi = [
  {"inputs":[{"internalType":"address","name":"_token","type":"address"}],
   "stateMutability":"nonpayable","type":"constructor"},
  {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],
   "name":"stake","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],
   "name":"unstake","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"claim","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"user","type":"address"}],
   "name":"pendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
   "stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],
   "name":"stakes","outputs":[
     {"internalType":"uint256","name":"amount","type":"uint256"},
     {"internalType":"uint256","name":"rewardDebt","type":"uint256"},
     {"internalType":"uint256","name":"lastUpdate","type":"uint256"}
   ],
   "stateMutability":"view","type":"function"}
];

let stakingContract, tokenContract;

/* ===== CONNECT WALLET ===== */
async function connectWallet() {
  if (!window.ethereum) return alert("Please install MetaMask");

  try {
    web3 = new Web3(window.ethereum);
    const accounts = await ethereum.request({ method: "eth_requestAccounts" });

    userAccount = accounts[0];
    isConnected = true;

    stakingContract = new web3.eth.Contract(stakingAbi, stakingAddress);
    tokenContract   = new web3.eth.Contract(erc20Abi, tokenAddress);

    document.getElementById("connectWallet").innerText = "Wallet Connected";
    document.getElementById("stakeInput").disabled = false;
    document.getElementById("stakeBtn").disabled = false;
    document.getElementById("claimBtn").disabled = false;
    document.getElementById("unstakeBtn").disabled = false;

    await refreshStats();

  } catch (e) {
    alert("Wallet connection cancelled");
  }
}

/* ===== REFRESH STATS ===== */
async function refreshStats() {
  if (!isConnected) return;

  const stakeInfo = await stakingContract.methods.stakes(userAccount).call();
  const rewards = await stakingContract.methods.pendingRewards(userAccount).call();

  document.getElementById("stakedAmount").innerText =
    web3.utils.fromWei(stakeInfo.amount, "ether");

  document.getElementById("pendingRewards").innerText =
    Number(web3.utils.fromWei(rewards, "ether")).toFixed(4);
}

/* ===== STAKE ===== */
async function stake() {
  const amount = document.getElementById("stakeInput").value;
  if (!amount) return;

  const wei = web3.utils.toWei(amount, "ether");

  await tokenContract.methods
    .approve(stakingAddress, wei)
    .send({ from: userAccount });

  await stakingContract.methods
    .stake(wei)
    .send({ from: userAccount });

  await refreshStats();
}

/* ===== CLAIM ===== */
async function claim() {
  await stakingContract.methods.claim().send({ from: userAccount });
  await refreshStats();
}

/* ===== UNSTAKE ===== */
async function unstake() {
  const amount = document.getElementById("stakeInput").value;
  if (!amount) return;

  const wei = web3.utils.toWei(amount, "ether");

  await stakingContract.methods
    .unstake(wei)
    .send({ from: userAccount });

  await refreshStats();
}

/* ===== EVENTS ===== */
document.getElementById("connectWallet").onclick = connectWallet;
document.getElementById("stakeBtn").onclick = stake;
document.getElementById("claimBtn").onclick = claim;
document.getElementById("unstakeBtn").onclick = unstake;
</script>
</body>
</html>
