<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CMNK Staking</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#061a38,#0a2f5f);
  color: #fff;
}

.container {
  max-width: 420px;
  margin: 60px auto;
  padding: 24px;
  background: rgba(255,255,255,0.08);
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0,0,0,.4);
}

h1 {
  text-align: center;
}

.sub {
  text-align: center;
  opacity: .9;
  margin-bottom: 20px;
}

.row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  margin-top: 10px;
  cursor: pointer;
}

.primary { background:#0cd3ff; color:#001; }
.white { background:#fff; color:#000; }
.red { background:#ff5c5c; color:#fff; }

input {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  margin-top: 10px;
}

.footer {
  margin-top: 14px;
  font-size: 12px;
  text-align: center;
  opacity: .7;
}
</style>
</head>

<body>
<div class="container">
  <h1>CMNK Staking</h1>
  <div class="sub">5% APR • No lock • BNB Chain</div>

  <div class="row"><span>Your Staked</span><span id="staked">-</span></div>
  <div class="row"><span>Pending Rewards</span><span id="rewards">-</span></div>

  <button id="connectBtn" class="primary">Connect Wallet</button>

  <input id="amount" placeholder="Amount to stake" disabled />
  <button id="stakeBtn" class="primary" disabled>Stake</button>
  <button id="claimBtn" class="white" disabled>Claim Rewards</button>
  <button id="unstakeBtn" class="red" disabled>Unstake</button>

  <div class="footer">
    Staking contract:<br>
    0x07d62b6725f559e4ca7dfc04586c0cf294f58aa9
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
const STAKING_ADDRESS = "0x07d62b6725f559e4ca7dfc04586c0cf294f58aa9";
const TOKEN_DECIMALS = 18;

const ABI = [
  "function stake(uint256 amount)",
  "function unstake(uint256 amount)",
  "function claim()",
  "function pendingRewards(address) view returns(uint256)",
  "function stakes(address) view returns(uint256 amount,uint256 rewardDebt,uint256 lastUpdate)"
];

let provider, signer, contract, account;

const connectBtn = document.getElementById("connectBtn");
const stakeBtn = document.getElementById("stakeBtn");
const claimBtn = document.getElementById("claimBtn");
const unstakeBtn = document.getElementById("unstakeBtn");
const amountInput = document.getElementById("amount");

async function connectWallet() {
  if (!window.ethereum) {
    alert("MetaMask not installed");
    return;
  }

  provider = new ethers.providers.Web3Provider(window.ethereum);
  const accounts = await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  account = accounts[0];
  contract = new ethers.Contract(STAKING_ADDRESS, ABI, signer);

  connectBtn.innerText = "Wallet Connected";
  amountInput.disabled = false;
  stakeBtn.disabled = false;
  claimBtn.disabled = false;
  unstakeBtn.disabled = false;

  updateUI();
}

async function updateUI() {
  if (!contract || !account) return;

  const stakeInfo = await contract.stakes(account);
  const pending = await contract.pendingRewards(account);

  document.getElementById("staked").innerText =
    ethers.utils.formatUnits(stakeInfo.amount, TOKEN_DECIMALS);

  document.getElementById("rewards").innerText =
    ethers.utils.formatUnits(pending, TOKEN_DECIMALS);
}

stakeBtn.onclick = async () => {
  const value = amountInput.value;
  if (!value || value <= 0) return;

  const tx = await contract.stake(
    ethers.utils.parseUnits(value, TOKEN_DECIMALS)
  );
  await tx.wait();
  updateUI();
};

claimBtn.onclick = async () => {
  const tx = await contract.claim();
  await tx.wait();
  updateUI();
};

unstakeBtn.onclick = async () => {
  const value = amountInput.value;
  if (!value || value <= 0) return;

  const tx = await contract.unstake(
    ethers.utils.parseUnits(value, TOKEN_DECIMALS)
  );
  await tx.wait();
  updateUI();
};

connectBtn.onclick = connectWallet;
</script>
</body>
</html>
