<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CMNK Staking</title>

<!-- ✅ POPRAWNY ethers v5 -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body {
  margin: 0;
  min-height: 100vh;
  background: radial-gradient(circle at top, #0a2a5e, #020814);
  font-family: Arial, sans-serif;
  color: #fff;
}

.card {
  max-width: 420px;
  margin: 120px auto;
  background: rgba(255,255,255,0.05);
  padding: 30px;
  border-radius: 16px;
  text-align: center;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

#connectBtn {
  background: #00ccff;
  color: #000;
}

.status {
  margin-top: 12px;
  font-size: 14px;
  opacity: 0.9;
}

.error {
  color: #ff6b6b;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="card">
  <h2>CMNK Staking</h2>
  <div style="opacity:.7;margin-bottom:12px">BNB Chain · Read-only</div>

  <div>Your Staked: <span id="staked">-</span></div>
  <div>Pending Rewards: <span id="rewards">-</span></div>

  <br>

  <button id="connectBtn">Connect Wallet</button>

  <div id="walletStatus" class="status">Wallet disconnected</div>
  <div id="error" class="error"></div>
</div>

<script>
/* ========= CONFIG ========= */
const STAKING_CONTRACT = "0x07d62b672f559e4ca7dfc04586c0cf294f58aa9";

/* MINIMAL ABI – TYLKO READ */
const stakingAbi = [
  {
    "inputs":[{"internalType":"address","name":"user","type":"address"}],
    "name":"pendingRewards",
    "outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
    "stateMutability":"view",
    "type":"function"
  },
  {
    "inputs":[{"internalType":"address","name":"","type":"address"}],
    "name":"stakes",
    "outputs":[
      {"internalType":"uint256","name":"amount","type":"uint256"},
      {"internalType":"uint256","name":"rewardDebt","type":"uint256"},
      {"internalType":"uint256","name":"lastUpdate","type":"uint256"}
    ],
    "stateMutability":"view",
    "type":"function"
  }
];

let provider;
let signer;
let user;
let contract;

/* ========= CONNECT ========= */
async function connectWallet() {
  try {
    if (!window.ethereum) {
      throw new Error("MetaMask not found");
    }

    // ✅ TYLKO TU prośba o połączenie
    const accounts = await window.ethereum.request({
      method: "eth_requestAccounts"
    });

    user = accounts[0];

    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    contract = new ethers.Contract(STAKING_CONTRACT, stakingAbi, provider);

    document.getElementById("connectBtn").innerText = "Wallet Connected";
    document.getElementById("connectBtn").disabled = true;

    document.getElementById("walletStatus").innerText =
      "Connected: " + user.slice(0,6) + "..." + user.slice(-4);

    console.log("✅ Wallet connected:", user);

    await readData();

  } catch (err) {
    console.error(err);
    document.getElementById("error").innerText = err.message;
  }
}

/* ========= READ ONLY ========= */
async function readData() {
  try {
    // ✅ stake info
    const stake = await contract.stakes(user);
    const rewards = await contract.pendingRewards(user);

    document.getElementById("staked").innerText =
      ethers.utils.formatUnits(stake.amount, 18);

    document.getElementById("rewards").innerText =
      ethers.utils.formatUnits(rewards, 18);

  } catch (err) {
    console.error(err);
    document.getElementById("error").innerText =
      "Read failed: " + err.message;
  }
}

/* ========= EVENTS ========= */
document.getElementById("connectBtn").onclick = connectWallet;
</script>

</body>
</html>
