<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CMNK Staking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Ethers v5 (SPRAWDZONY CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #0b2a4a, #000814);
      font-family: Arial, sans-serif;
      color: #fff;
    }
    .card {
      background: #0e2a4d;
      padding: 30px;
      border-radius: 16px;
      width: 320px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,.5);
    }
    h1 { margin-top: 0; }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
    }
    button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    .blue { background:#00cfff; }
    .red { background:#ff5c5c; }
    .status {
      font-size: 12px;
      margin-top: 10px;
      opacity: .8;
    }
    .error {
      color:#ff6b6b;
      font-size:12px;
      margin-top:10px;
    }
  </style>
</head>
<body>

<div class="card">
  <h1>CMNK Staking</h1>
  <div>BNB Chain</div><br>

  <div>Your Staked: <span id="staked">-</span></div>
  <div>Pending Rewards: <span id="rewards">-</span></div><br>

  <button class="blue" onclick="connectWallet()">Connect Wallet</button>

  <input id="amount" placeholder="Amount to stake" />

  <button class="blue" onclick="stake()">Stake</button>
  <button class="blue" onclick="claim()">Claim Rewards</button>
  <button class="red" onclick="unstake()">Unstake</button>

  <div class="status" id="status">Wallet disconnected</div>
  <div class="error" id="error"></div>
</div>

<script>
/* ================== CONFIG ================== */

// üî¥ WSTAW POPRAWNY ADRES (42 znaki!)
const STAKING_CONTRACT_ADDRESS = "0xXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";

// üî¥ WSTAW TEN SAM ABI, KT√ìREGO U≈ªYWA≈ÅE≈ö WCZE≈öNIEJ
const STAKING_ABI = [
  "function stake(uint256 amount)",
  "function unstake()",
  "function claim()",
  "function stakedBalance(address) view returns (uint256)",
  "function pendingRewards(address) view returns (uint256)"
];

/* ================== GLOBALS ================== */
let provider;
let signer;
let contract;
let userAddress;

/* ================== CONNECT ================== */
async function connectWallet() {
  try {
    if (!window.ethereum) throw "MetaMask not found";

    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);

    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    contract = new ethers.Contract(
      STAKING_CONTRACT_ADDRESS,
      STAKING_ABI,
      signer
    );

    document.getElementById("status").innerText =
      "Connected: " + userAddress.slice(0,6) + "..." + userAddress.slice(-4);

    document.getElementById("error").innerText = "";

    await refreshData();

  } catch (err) {
    document.getElementById("error").innerText = err.toString();
  }
}

/* ================== READ ================== */
async function refreshData() {
  try {
    const staked = await contract.stakedBalance(userAddress);
    const rewards = await contract.pendingRewards(userAddress);

    document.getElementById("staked").innerText =
      ethers.utils.formatUnits(staked, 18);

    document.getElementById("rewards").innerText =
      ethers.utils.formatUnits(rewards, 18);

  } catch (err) {
    document.getElementById("error").innerText = err.toString();
  }
}

/* ================== ACTIONS ================== */
async function stake() {
  try {
    const amount = document.getElementById("amount").value;
    const tx = await contract.stake(
      ethers.utils.parseUnits(amount, 18)
    );
    await tx.wait();
    refreshData();
  } catch (err) {
    document.getElementById("error").innerText = err.toString();
  }
}

async function claim() {
  try {
    const tx = await contract.claim();
    await tx.wait();
    refreshData();
  } catch (err) {
    document.getElementById("error").innerText = err.toString();
  }
}

async function unstake() {
  try {
    const tx = await contract.unstake();
    await tx.wait();
    refreshData();
  } catch (err) {
    document.getElementById("error").innerText = err.toString();
  }
}
</script>

</body>
</html>
