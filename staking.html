<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CMNK Staking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #0a2540, #0b3d91);
  color: #fff;
}
.container {
  max-width: 420px;
  margin: 60px auto;
  padding: 24px;
  background: rgba(255,255,255,0.06);
  border-radius: 16px;
}
button, input {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
}
button {
  background: #00ccff;
  font-weight: bold;
  cursor: pointer;
}
.secondary { background: #fff; color:#002b5c; }
.danger { background:#ff5c5c; color:#fff; }
.stat { display:flex; justify-content:space-between; margin-top:8px; }
</style>
</head>

<body>
<div class="container">
  <h1 style="text-align:center">CMNK Staking</h1>
  <div class="stat"><span>Your Staked</span><strong id="staked">-</strong></div>
  <div class="stat"><span>Pending Rewards</span><strong id="rewards">-</strong></div>

  <button id="connectBtn">Connect Wallet</button>

  <input id="amountInput" type="number" placeholder="Amount to stake" disabled />
  <button id="stakeBtn" disabled>Stake</button>
  <button id="claimBtn" class="secondary" disabled>Claim</button>
  <button id="unstakeBtn" class="danger" disabled>Unstake</button>

  <p style="font-size:12px;opacity:.7;margin-top:12px">
    Staking contract:<br>
    0x07d62b6725f559e4ca7dfc04586c0cf294f58aa9
  </p>
</div>

<script>
/* ================= CONFIG ================= */
const STAKING_ADDRESS = "0x07d62b6725f559e4ca7dfc04586c0cf294f58aa9";
const TOKEN_ADDRESS   = "0xd17c85824eB60d40D332e64B0167E0B4029F49BA";

/* ================= ABI ================= */
const stakingAbi = [
  "function stake(uint256)",
  "function unstake(uint256)",
  "function claim()",
  "function pendingRewards(address) view returns (uint256)",
  "function stakes(address) view returns (uint256 amount, uint256 rewardDebt, uint256 lastUpdate)"
];

const erc20Abi = [
  "function approve(address,uint256) returns (bool)"
];

/* ================= STATE ================= */
let provider, signer, user, staking, token;

/* ================= ELEMENTS ================= */
const connectBtn = document.getElementById("connectBtn");
const stakeBtn   = document.getElementById("stakeBtn");
const claimBtn   = document.getElementById("claimBtn");
const unstakeBtn = document.getElementById("unstakeBtn");
const amountIn   = document.getElementById("amountInput");

/* ================= CONNECT ================= */
connectBtn.onclick = async () => {
  if (!window.ethereum) {
    alert("MetaMask not found");
    return;
  }

  provider = new ethers.providers.Web3Provider(window.ethereum, "any");
  await provider.send("eth_requestAccounts", []);

  signer = provider.getSigner();
  user   = await signer.getAddress();

  staking = new ethers.Contract(STAKING_ADDRESS, stakingAbi, signer);
  token   = new ethers.Contract(TOKEN_ADDRESS, erc20Abi, signer);

  connectBtn.innerText = "Wallet Connected";
  connectBtn.disabled = true;

  amountIn.disabled = false;
  stakeBtn.disabled = false;
  claimBtn.disabled = false;
  unstakeBtn.disabled = false;

  await refreshUI();
};

/* ================= READ ================= */
async function refreshUI() {
  const s = await staking.stakes(user);
  const r = await staking.pendingRewards(user);

  document.getElementById("staked").innerText =
    ethers.utils.formatUnits(s.amount, 18);

  document.getElementById("rewards").innerText =
    ethers.utils.formatUnits(r, 18);
}

/* ================= STAKE ================= */
stakeBtn.onclick = async () => {
  const amount = amountIn.value;
  if (!amount) return;

  const value = ethers.utils.parseUnits(amount, 18);
  await token.approve(STAKING_ADDRESS, value);
  await staking.stake(value);

  await refreshUI();
};

/* ================= CLAIM ================= */
claimBtn.onclick = async () => {
  await staking.claim();
  await refreshUI();
};

/* ================= UNSTAKE ================= */
unstakeBtn.onclick = async () => {
  const amount = amountIn.value;
  if (!amount) return;

  const value = ethers.utils.parseUnits(amount, 18);
  await staking.unstake(value);
  await refreshUI();
};
</script>
</body>
</html>
