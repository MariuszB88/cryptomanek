<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CMNK Staking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #0a2a43, #020c1b);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .card {
      width: 420px;
      background: linear-gradient(180deg, #0f3a5a, #06192e);
      border-radius: 18px;
      padding: 24px;
      box-shadow: 0 20px 50px rgba(0,0,0,.6);
    }
    h1 {
      text-align: center;
      margin: 0;
      font-size: 28px;
    }
    h2 {
      text-align: center;
      font-size: 14px;
      font-weight: normal;
      opacity: .8;
      margin-top: 6px;
    }
    .pill {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      background: rgba(255,255,255,.08);
      font-size: 12px;
      margin: 6px 4px;
    }
    .stats {
      margin-top: 16px;
      background: rgba(0,0,0,.25);
      border-radius: 12px;
      padding: 14px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 6px 0;
    }
    button {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: none;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    .primary { background: #00c3ff; color: #002; }
    .secondary { background: rgba(255,255,255,.1); color: #fff; }
    .danger { background: #ff4d4d; color: #fff; }
    input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      margin-top: 10px;
      font-size: 15px;
    }
    .footer {
      text-align: center;
      font-size: 12px;
      opacity: .7;
      margin-top: 12px;
    }
    a { color: #7fd4ff; text-decoration: none; }
  </style>
</head>

<body>
  <div class="card">
    <h1>CMNK Staking</h1>
    <h2>BNB Chain</h2>

    <div style="text-align:center">
      <span class="pill">Network: 56</span>
      <span class="pill" id="refreshStatus">Auto-refresh: off</span>
    </div>

    <div class="stats">
      <div class="row"><span>Your Staked</span><span id="yourStaked">-</span></div>
      <div class="row"><span>Pending Rewards</span><span id="pendingRewards">-</span></div>
      <div class="row"><span>APR</span><span id="apr">5%</span></div>
      <div class="row"><span>Est. Daily Rewards</span><span id="dailyRewards">-</span></div>
    </div>

    <button class="primary" id="connectBtn">Connect Wallet</button>

    <button class="secondary" id="addTokenBtn">Add CMNK to MetaMask</button>
    <button class="secondary" id="autoRefreshBtn">Enable Auto-refresh</button>

    <input id="amountInput" placeholder="Amount" />

    <button class="secondary" id="maxWalletBtn">MAX (Wallet)</button>
    <button class="secondary" id="maxStakedBtn">MAX (Staked)</button>

    <button class="primary" id="stakeBtn">Stake</button>
    <button class="secondary" id="claimBtn">Claim Rewards</button>
    <button class="danger" id="unstakeBtn">Unstake</button>
    <button class="danger" id="unstakeAllBtn">Unstake All</button>

    <div class="footer" id="status">Wallet disconnected</div>
    <div class="footer">
      <a href="https://bscscan.com/token/0xd17c85824eB60d40D332e64B0167E0B4029F49BA" target="_blank">CMNK Token</a> Â·
      <a href="https://bscscan.com/address/0x07d62b6725F559E4ca7dFC04586c0cf294F58AA9" target="_blank">Staking Contract</a>
    </div>
  </div>

<script>
/* ===== CONFIG ===== */
const APR_PERCENT = 5;
const TOKEN_ADDRESS = "0xd17c85824eB60d40D332e64B0167E0B4029F49BA";
const STAKING_ADDRESS = "0x07d62b6725F559E4ca7dFC04586c0cf294F58AA9";
const TOKEN_DECIMALS = 18;

/* ===== ABIs ===== */
const tokenABI = [
  "function balanceOf(address) view returns (uint256)",
  "function approve(address,uint256)"
];
const stakingABI = [
  "function stake(uint256)",
  "function unstake(uint256)",
  "function claim()",
  "function stakedAmount(address) view returns (uint256)",
  "function pendingRewards(address) view returns (uint256)"
];

let provider, signer, user, token, staking;
let autoRefresh = false;
let interval;

/* ===== HELPERS ===== */
function format(amount) {
  return parseFloat(amount).toLocaleString(undefined,{maximumFractionDigits:6});
}

function updateDaily(staked) {
  const daily = staked * (APR_PERCENT / 100 / 365);
  document.getElementById("dailyRewards").innerText =
    daily > 0 ? format(daily) + " CMNK" : "-";
}

/* ===== CONNECT ===== */
document.getElementById("connectBtn").onclick = async () => {
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  user = await signer.getAddress();

  token = new ethers.Contract(TOKEN_ADDRESS, tokenABI, signer);
  staking = new ethers.Contract(STAKING_ADDRESS, stakingABI, signer);

  document.getElementById("connectBtn").innerText = "Wallet Connected";
  document.getElementById("status").innerText = "Connected: " + user.slice(0,6)+"..."+user.slice(-4);

  refresh();
};

/* ===== REFRESH ===== */
async function refresh() {
  if (!user) return;
  const staked = Number(ethers.utils.formatUnits(await staking.stakedAmount(user), TOKEN_DECIMALS));
  const pending = Number(ethers.utils.formatUnits(await staking.pendingRewards(user), TOKEN_DECIMALS));

  document.getElementById("yourStaked").innerText = format(staked) + " CMNK";
  document.getElementById("pendingRewards").innerText = format(pending) + " CMNK";

  updateDaily(staked);
}

/* ===== BUTTONS ===== */
document.getElementById("addTokenBtn").onclick = async () => {
  await ethereum.request({
    method: "wallet_watchAsset",
    params: {
      type: "ERC20",
      options: {
        address: TOKEN_ADDRESS,
        symbol: "CMNK",
        decimals: 18
      }
    }
  });
};

document.getElementById("autoRefreshBtn").onclick = () => {
  autoRefresh = !autoRefresh;
  document.getElementById("refreshStatus").innerText =
    autoRefresh ? "Auto-refresh: on (20s)" : "Auto-refresh: off";
  document.getElementById("autoRefreshBtn").innerText =
    autoRefresh ? "Disable Auto-refresh" : "Enable Auto-refresh";

  if (autoRefresh) interval = setInterval(refresh, 20000);
  else clearInterval(interval);
};

document.getElementById("maxWalletBtn").onclick = async () => {
  const bal = Number(ethers.utils.formatUnits(await token.balanceOf(user), TOKEN_DECIMALS));
  amountInput.value = bal;
};

document.getElementById("maxStakedBtn").onclick = async () => {
  const st = Number(ethers.utils.formatUnits(await staking.stakedAmount(user), TOKEN_DECIMALS));
  amountInput.value = st;
};

document.getElementById("stakeBtn").onclick = async () => {
  const amt = ethers.utils.parseUnits(amountInput.value, TOKEN_DECIMALS);
  await token.approve(STAKING_ADDRESS, amt);
  await staking.stake(amt);
  refresh();
};

document.getElementById("claimBtn").onclick = async () => {
  await staking.claim();
  refresh();
};

document.getElementById("unstakeBtn").onclick = async () => {
  const amt = ethers.utils.parseUnits(amountInput.value, TOKEN_DECIMALS);
  await staking.unstake(amt);
  refresh();
};

document.getElementById("unstakeAllBtn").onclick = async () => {
  const st = await staking.stakedAmount(user);
  await staking.unstake(st);
  refresh();
};
</script>
</body>
</html>
