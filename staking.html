<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CMNK Staking – Connect & Read</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #0b3a78, #050b1a);
  color: #fff;
}
.card {
  max-width: 420px;
  margin: 120px auto;
  background: #0c234d;
  border-radius: 14px;
  padding: 30px;
  text-align: center;
  box-shadow: 0 20px 50px rgba(0,0,0,.4);
}
h1 { margin-bottom: 6px; }
button {
  width: 100%;
  padding: 14px;
  margin-top: 16px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: #00c6ff;
  color: #000;
  font-weight: bold;
}
.read {
  margin-top: 20px;
  font-size: 14px;
}
small { color: #9bb3ff; }
.error { color: #ff6b6b; margin-top: 10px; }
</style>
</head>

<body>

<div class="card">
  <h1>CMNK Staking</h1>
  <small>BNB Chain • Read-only</small>

  <div class="read">
    <p>Your Staked: <b id="staked">-</b></p>
    <p>Pending Rewards: <b id="rewards">-</b></p>
  </div>

  <button id="connectBtn">Connect Wallet</button>

  <p id="address"></p>
  <p id="status"><small>Wallet disconnected</small></p>
  <p id="error" class="error"></p>
</div>

<!-- ✅ JEDYNA POPRAWNA WERSJA ETHERS -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
/* ================= CONFIG ================= */

const STAKING_ADDRESS = "0x07d62b672f559e4ca7dfc04586c0cf294f58aa9";

const STAKING_ABI = [
  "function stakes(address) view returns (uint256 amount, uint256 rewardDebt, uint256 lastUpdate)",
  "function pendingRewards(address) view returns (uint256)"
];

/* ============== STATE ============== */

let provider;
let contract;

/* ============== CONNECT ============== */

async function connectWallet() {
  try {
    if (!window.ethereum) {
      alert("MetaMask not installed");
      return;
    }

    // ✅ ZAWSZE popup MetaMask
    const accounts = await window.ethereum.request({
      method: "eth_requestAccounts"
    });

    const user = accounts[0];

    provider = new ethers.providers.Web3Provider(window.ethereum);
    contract = new ethers.Contract(
      STAKING_ADDRESS,
      STAKING_ABI,
      provider
    );

    document.getElementById("address").textContent =
      "Connected: " + user.slice(0, 6) + "..." + user.slice(-4);

    document.getElementById("status").innerHTML =
      "<small>Wallet connected</small>";

    await loadData(user);

  } catch (err) {
    console.error(err);
    document.getElementById("error").textContent =
      err.message || "Connection failed";
  }
}

/* ============== READ DATA ============== */

async function loadData(user) {
  try {
    const stakeInfo = await contract.stakes(user);
    const rewards = await contract.pendingRewards(user);

    document.getElementById("staked").textContent =
      ethers.utils.formatUnits(stakeInfo.amount, 18);

    document.getElementById("rewards").textContent =
      ethers.utils.formatUnits(rewards, 18);

  } catch (err) {
    console.error(err);
    document.getElementById("error").textContent =
      "Read failed: " + err.message;
  }
}

/* ============== EVENTS ============== */

document
  .getElementById("connectBtn")
  .addEventListener("click", connectWallet);

</script>

</body>
</html>
